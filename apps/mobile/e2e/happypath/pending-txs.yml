appId: global.safe.mobileapp.ios
---
# Pending Transactions E2E Test Happy Path
# Sets up the app with mocked safes and signer for pending transaction tests

- runFlow:
    file: ../shared/clean-app-start.yml

- tapOn:
    id: 'e2ePendingTxs'

- assertVisible:
    id: 'home-tab'

# Verify we're on the home screen with the first pending tx safe loaded
- assertVisible:
    id: 'dropdown-label-view'
    index: 0

# ===========================================
# Navigate to Pending Transactions
# ===========================================
# Tap on the pending transactions banner
- tapOn:
    id: 'pending-transactions'

- assertVisible:
    id: 'pending-tx-list'

# Verify we see the "Next" section header
- assertVisible:
    text: 'Next'

# ===========================================
# Conflicting Transactions
# ===========================================
# Test the conflicting transactions card
# Pass comma-separated environment variables for the expected transaction types and details
- runFlow:
    file: ../components/pending-tx/conflicting-txs-card.yml
    env:
      TX_TYPES: 'Send,Settings change'
      TX_DETAILS: '0\.00002 ETH,addOwnerWithThreshold'
      CONFIRMATIONS_PATTERN: '.*1/1.*'

# ===========================================
# First Transaction: Send Transaction
# ===========================================
# Click on the first send transaction in the conflicting group
- runFlow:
    file: ../components/pending-tx/send-tx-card.yml

# ===========================================
# Second Transaction: Settings Change Transaction
# ===========================================
# Click on the second settings change transaction in the conflicting group
- runFlow:
    file: ../components/pending-tx/settings-change-new-signer-tx-card.yml

# ===========================================
# Switch to Pending Tx Safe 2 for Limit Order Test
# ===========================================
# Go back to home tab
- tapOn:
    id: 'go-back'

- runFlow:
    file: ../shared/switch-safe.yml
    env:
      SAFE_NAME_PATTERN: '.*Pending Tx Safe 2.*'

# Navigate to pending transactions
- tapOn:
    id: 'pending-transactions'

- assertVisible:
    id: 'pending-tx-list'

# Verify we see the "Next" section header
- assertVisible:
    text: 'Next'

# ===========================================
# Limit Order Transaction
# ===========================================
# Test the first limit order in the "Next" section
- runFlow:
    file: ../components/pending-tx/limit-order-tx-card.yml

# ===========================================
# Expired Swap Order Transaction
# ===========================================
# Test an expired swap order in the "In queue" section
# Expired swap orders should NOT display a Continue button
- runFlow:
    file: ../components/pending-tx/swap-order-tx-card.yml
    env:
      ORDER_STATUS: 'Expired'

# ===========================================
# TWAP Order Transaction
# ===========================================
# Test a TWAP order in the "In queue" section
- runFlow:
    file: ../components/pending-tx/twap-order-tx-card.yml
    env:
      ORDER_STATUS: 'Execution needed'

# ===========================================
# On-Chain Rejection Transaction
# ===========================================
# Test the on-chain rejection in the conflicting transactions section
# This rejection cannot be executed because other transactions with lower nonces need to be executed first
- runFlow:
    file: ../components/pending-tx/on-chain-rejection-tx-card.yml
    env:
      IS_EXECUTABLE: 'false'

# ===========================================
# Switch to Pending Tx Safe 3 for setFallbackHandler Test
# ===========================================
# Go back to home tab
- tapOn:
    id: 'go-back'

- runFlow:
    file: ../shared/switch-safe.yml
    env:
      SAFE_NAME_PATTERN: '.*Pending Tx Safe 3.*'

# Navigate to pending transactions
- tapOn:
    id: 'pending-transactions'

- assertVisible:
    id: 'pending-tx-list'

# Verify we see the "Next" section header
- assertVisible:
    text: 'Next'

# ===========================================
# setFallbackHandler Transaction
# ===========================================
# Test the first setFallbackHandler transaction in the "Next" section
- runFlow:
    file: ../components/pending-tx/setFallbackHandler-tx-card.yml

# ===========================================
# Switch to Pending Tx Safe 4 for Batch Transaction Test
# ===========================================
# Go back to home tab
- tapOn:
    id: 'go-back'

- runFlow:
    file: ../shared/switch-safe.yml
    env:
      SAFE_NAME_PATTERN: '.*Pending Tx Safe 4.*'

# Navigate to pending transactions
- tapOn:
    id: 'pending-transactions'

- assertVisible:
    id: 'pending-tx-list'

# Verify we see the "Next" section header
- assertVisible:
    text: 'Next'

# ===========================================
# Batch Transaction
# ===========================================
# Test the batch transaction in the "Next" section
# This batch transaction cannot be executed because threshold hasn't been reached (1/2 confirmations)
- runFlow:
    file: ../components/pending-tx/batch-tx-card.yml
    env:
      IS_EXECUTABLE: 'false'
