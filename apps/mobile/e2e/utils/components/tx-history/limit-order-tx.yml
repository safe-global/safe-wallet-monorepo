appId: ${APP_ID}
tags:
  - util
---
- runScript:
    file: ../../../utils/scripts/defaults.js
# ===========================================
# Limit Order Transaction
# ===========================================
- assertVisible: Transaction details

# Verify swap order container is visible
- assertVisible:
    id: 'history-swap-order-container'

# ===========================================
# Swap Header - Sell and Receive Sections
# ===========================================
- assertVisible:
    id: 'history-swap-order-header'

# Verify sell container and amount
- assertVisible:
    id: 'swap-header-sell-container'
- assertVisible: Sell
- assertVisible:
    id: 'swap-header-sell-amount'
    text: '.*\d+.*[A-Z]{2,}.*'

# Verify receive container and amount
- assertVisible:
    id: 'swap-header-receive-container'
- assertVisible: 'For at least'
- assertVisible:
    id: 'swap-header-receive-amount'
    text: '.*\d+.*[A-Z]{2,}.*'

# ===========================================
# Limit Order Details Section
# ===========================================
- assertVisible:
    id: 'history-swap-order-details'

# Price row - can be "Limit price" or "Execution price" (if fulfilled)
- assertVisible:
    id: 'history-swap-order-details'
    containsDescendants:
      - text: '.*(Limit price|Execution price).*'

# Verify price format (1 TOKEN = AMOUNT TOKEN)
- assertVisible:
    id: 'history-swap-order-details'
    containsDescendants:
      - text: '.*1 [A-Z]{2,} = .*\d+.*[A-Z]{2,}.*'

# Order ID row (scoped to details section)
- assertVisible:
    id: 'history-swap-order-details'
    containsDescendants:
      - text: 'Order ID'
- assertVisible:
    id: 'history-swap-order-details'
    containsDescendants:
      - text: '0x[0-9a-fA-F]{4}.*'

# Network row (scoped to details section)
- assertVisible:
    id: 'history-swap-order-details'
    containsDescendants:
      - text: 'Network'

# Status row (scoped to details section)
# Status can be "Expired" or "Filled" (for fulfilled orders)
- assertVisible:
    id: 'history-swap-order-details'
    containsDescendants:
      - text: 'Status'
- assertVisible:
    id: 'history-swap-order-details'
    containsDescendants:
      - text: '.*(Expired|Filled|partiallyFilled).*'

# Total fees row (scoped to details section)
# Only shown if there are executed fees
- extendedWaitUntil:
    visible:
      id: 'history-swap-order-details'
      containsDescendants:
        - text: 'Total fees'
      optional: true
<<<<<<< HEAD:apps/mobile/e2e/utils/components/tx-history/limit-order-tx.yml
    timeout: ${output.defaults.extendedWaitUntilTimeout}
=======
    timeout: 2000
>>>>>>> origin/main:apps/mobile/e2e/components/tx-history/limit-order-tx.yml
- extendedWaitUntil:
    visible:
      id: 'history-swap-order-details'
      containsDescendants:
        - text: '.*\d+.*[A-Z]{2,}.*'
      optional: true
<<<<<<< HEAD:apps/mobile/e2e/utils/components/tx-history/limit-order-tx.yml
    timeout: ${output.defaults.extendedWaitUntilTimeout}
=======
    timeout: 2000
>>>>>>> origin/main:apps/mobile/e2e/components/tx-history/limit-order-tx.yml

# ===========================================
# Transaction Details Button
# ===========================================
- runFlow:
    file: ../../assertions/verify-tx-details.yml

# ===========================================
# Common Transaction Info
# ===========================================
- runFlow:
    file: ../../assertions/verify-tx-info.yml

# ===========================================
# Verify Transaction Status
# The transaction hash status is typically "Success" even if order status is "Expired"
# ===========================================
- assertVisible: 'Status'
- assertVisible:
    text: '.*Success.*'

# ===========================================
# Confirmations
# ===========================================
- runFlow:
    file: ../../assertions/verify-tx-history-confirmations.yml

# ===========================================
# Test Explorer Link
# ===========================================
- runFlow:
    file: ../../assertions/verify-explorer-link.yml

- assertVisible: Transaction details

# ===========================================
# Test Share Transaction Button
# ===========================================
- runFlow:
    file: ../../assertions/verify-share-link.yml

- assertVisible: Transaction details

# ===========================================
# Test Transaction Details Button
# ===========================================
- runFlow:
    file: ../../assertions/verify-advanced-details.yml

- assertVisible: Transaction details
